<!doctype html>
<head>
	<title>RCT prototype</title>
	<link rel="stylesheet" href="/css/src/bootstrap.css">
	<script src="/js/src/compatibility.js"></script>

	<!-- Load the session service, parse variables provided by server in the query -->
	<script type="module">
		import sessionService from '/js/src/sessionService.js';
		sessionService.loadAndHideParameters();
		if (sessionStorage.hasOwnProperty('logged') &&
				sessionStorage.logged === "true") {
			console.log("Try to relog");
			sessionService.session.username = sessionStorage.username;
			sessionService.session.password = sessionStorage.password;
			sessionService.session.token = sessionStorage.token;
			sessionService.session.dbname = sessionStorage.dbname;
		}

		window.sesService = sessionService;
		sessionStorage.sesService = sessionService;
	</script>

	<!-- Main application controller -->
	<script type="module">


		// Import MVC
		import {mount} from '/js/src/index.js';
		import view from './view.js';
		import Model from './Model.js';

		// Start application
		const model = new Model();
		const debug = true; // shows when redraw is done
		mount(document.body, view, model, debug);

		// Expose model to interact with it the browser's console
		window.model = model;
		if (sessionStorage.hasOwnProperty("logged") && sessionStorage.logged === "true") {
			model.logged = true;
			model.notify();
		}
	</script>
</head>